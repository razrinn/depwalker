# name: Test & Build

# on:
#   push:
#     branches: [ main, develop ]
#   pull_request:
#     branches: [ main ]

# jobs:
#   test:
#     runs-on: ubuntu-latest

#     strategy:
#       matrix:
#         node-version: [18, 20, 22]

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4

#     - name: Setup pnpm
#       uses: pnpm/action-setup@v4
#       with:
#         version: latest

#     - name: Setup Node.js ${{ matrix.node-version }}
#       uses: actions/setup-node@v4
#       with:
#         node-version: ${{ matrix.node-version }}
#         cache: 'pnpm'

#     - name: Install dependencies
#       run: pnpm install --frozen-lockfile

#     - name: Run tests
#       run: pnpm test:run

#     - name: Run tests with coverage
#       run: pnpm test:coverage

#     - name: Build project
#       run: pnpm build

#     - name: Upload coverage reports
#       if: matrix.node-version == 20 # Only upload once
#       uses: codecov/codecov-action@v4
#       with:
#         fail_ci_if_error: false
#         verbose: true

#   lint-and-type-check:
#     runs-on: ubuntu-latest

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4

#     - name: Setup pnpm
#       uses: pnpm/action-setup@v4
#       with:
#         version: latest

#     - name: Setup Node.js
#       uses: actions/setup-node@v4
#       with:
#         node-version: 20
#         cache: 'pnpm'

#     - name: Install dependencies
#       run: pnpm install --frozen-lockfile

#     - name: Type check
#       run: pnpm exec tsc --noEmit

#     - name: Security audit
#       run: pnpm audit
#       continue-on-error: true # Don't fail CI on audit issues

#   integration-test:
#     runs-on: ubuntu-latest
#     needs: [test]

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4
#       with:
#         fetch-depth: 0 # Need git history for depwalker

#     - name: Setup pnpm
#       uses: pnpm/action-setup@v4
#       with:
#         version: latest

#     - name: Setup Node.js
#       uses: actions/setup-node@v4
#       with:
#         node-version: 20
#         cache: 'pnpm'

#     - name: Install dependencies
#       run: pnpm install --frozen-lockfile

#     - name: Build project
#       run: pnpm build

#     - name: Test CLI with no changes
#       run: |
#         # Should handle no changes gracefully
#         pnpm depwalker --format json || echo "No changes detected (expected)"

#     - name: Make test change and run analysis
#       run: |
#         # Make a small change to test the tool
#         echo "// Test comment" >> src/analyzer.ts
#         git add .
#         git config user.email "test@example.com"
#         git config user.name "Test User"

#         # Run depwalker on the change
#         pnpm depwalker --format json --max-nodes 10
